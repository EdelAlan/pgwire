version: '3.4'
services:
  test:
    build: .
    environment:
      POSTGRES: postgres://postgres:5432
    depends_on: [postgres]
    working_dir: /opt/pgwire
    volumes: ['..:/opt/pgwire']

  repl:
    image: node:11-alpine
    command: sh -c 'sleep 5 && node test/repl.js'
    depends_on: [postgres]
    working_dir: /opt/pgwire
    volumes: ['..:/opt/pgwire']

  postgres:
    build:
      context: .
      dockerfile: pg.dockerfile
